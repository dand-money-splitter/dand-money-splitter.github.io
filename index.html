<!DOCTYPE html>
<html>

<head>
	<title>Money Splitter!</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
		integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
	<meta name="viewport" content="width=device-width, initial-scale=0.8, shrink-to-fit=yes">
</head>

<body>
	<div class="container-fluid">
		<div class="container">
			<h1>Money Splitter!</h1>
		</div>
		<hr>
		<div class="container">
			<div class="card">
				<div class="card-body">
					<div class="row">
						<div class="col-md-4">
							<div class="input-group input-group-sm mb-3">
								<div class="input-group-prepend">
									<span class="input-group-text" id="copper">Copper</span>
								</div>
								<input type="number" id="copperInput" class="form-control" aria-label="Small"
									aria-describedby="inputGroup-sizing-sm">
							</div>
							<div class="input-group input-group-sm mb-3">
								<div class="input-group-prepend">
									<span class="input-group-text" id="silver">Silver</span>
								</div>
								<input type="number" id="silverInput" class="form-control" aria-label="Small"
									aria-describedby="inputGroup-sizing-sm">
							</div>
							<div class="input-group input-group-sm mb-3">
								<div class="input-group-prepend">
									<span class="input-group-text" id="electrum">Electrum</span>
								</div>
								<input type="number" id="electrumInput" class="form-control" aria-label="Small"
									aria-describedby="inputGroup-sizing-sm">
							</div>
							<div class="input-group input-group-sm mb-3">
								<div class="input-group-prepend">
									<span class="input-group-text" id="gold">Gold</span>
								</div>
								<input type="number" id="goldInput" class="form-control" aria-label="Small"
									aria-describedby="inputGroup-sizing-sm">
							</div>
							<div class="input-group input-group-sm mb-3">
								<div class="input-group-prepend">
									<span class="input-group-text" id="platinum">Platinum</span>
								</div>
								<input type="number" id="platinumInput" class="form-control" aria-label="Small"
									aria-describedby="inputGroup-sizing-sm">
							</div>
						</div>
						<div class="col-md-8">
							<div class="input-group input-group-sm mb-3">
								<div class="input-group-prepend">
									<span class="input-group-text bg-dark text-white" id="players">Number of Players</span>
								</div>
								<input type="number" id="playersInput" class="form-control" aria-label="Small"
									aria-describedby="inputGroup-sizing-sm">
							</div>
							<table class="table table-sm" id="output">
								<tr>
									<th>Player</th>
									<th>Copper</th>
									<th>Silver</th>
									<th>Elect</th>
									<th>Gold</th>
									<th>Plat</th>
									<th>Items</th>
									<th>Total</th>
								</tr>

							</table>
						</div>

					</div>
					<div class="row">
						<div class="col">
							<h3>Items</h3>
							<table class="table table-sm" id="items">
								<tr>
									<th>Name</th>
									<th>Count</th>
									<th>Copper</th>
									<th>Silver</th>
									<th>Electrum</th>
									<th>Gold</th>
									<th>Platinum</th>
								</tr>
								<tr id="item_1_row">
									<td><input type="text" id="item_1_name_input" class="form-control" aria-label="Small"
											aria-describedby="inputGroup-sizing-sm"></td>
									<td><input type="text" id="item_1_count_input" class="form-control" aria-label="Small"
											aria-describedby="inputGroup-sizing-sm"></td>
									<td><input type="number" id="item_1_copper_input" class="form-control" aria-label="Small"
											aria-describedby="inputGroup-sizing-sm"></td>
									<td><input type="number" id="item_1_silver_input" class="form-control" aria-label="Small"
											aria-describedby="inputGroup-sizing-sm"></td>
									<td><input type="number" id="item_1_elect_input" class="form-control" aria-label="Small"
											aria-describedby="inputGroup-sizing-sm"></td>
									<td><input type="number" id="item_1_gold_input" class="form-control" aria-label="Small"
											aria-describedby="inputGroup-sizing-sm"></td>
									<td><input type="number" id="item_1_plat_input" class="form-control" aria-label="Small"
											aria-describedby="inputGroup-sizing-sm"></td>
								</tr>
								<tr id="item_2_row">
									<td><input type="text" id="item_2_name_input" class="form-control" aria-label="Small"
											aria-describedby="inputGroup-sizing-sm"></td>
									<td><input type="text" id="item_2_count_input" class="form-control" aria-label="Small"
											aria-describedby="inputGroup-sizing-sm"></td>
									<td><input type="number" id="item_2_copper_input" class="form-control" aria-label="Small"
											aria-describedby="inputGroup-sizing-sm"></td>
									<td><input type="number" id="item_2_silver_input" class="form-control" aria-label="Small"
											aria-describedby="inputGroup-sizing-sm"></td>
									<td><input type="number" id="item_2_elect_input" class="form-control" aria-label="Small"
											aria-describedby="inputGroup-sizing-sm"></td>
									<td><input type="number" id="item_2_gold_input" class="form-control" aria-label="Small"
											aria-describedby="inputGroup-sizing-sm"></td>
									<td><input type="number" id="item_2_plat_input" class="form-control" aria-label="Small"
											aria-describedby="inputGroup-sizing-sm"></td>
								</tr>
								<tr id="item_3_row">
									<td><input type="text" id="item_3_name_input" class="form-control" aria-label="Small"
											aria-describedby="inputGroup-sizing-sm"></td>
									<td><input type="text" id="item_3_count_input" class="form-control" aria-label="Small"
											aria-describedby="inputGroup-sizing-sm"></td>
									<td><input type="number" id="item_3_copper_input" class="form-control" aria-label="Small"
											aria-describedby="inputGroup-sizing-sm"></td>
									<td><input type="number" id="item_3_silver_input" class="form-control" aria-label="Small"
											aria-describedby="inputGroup-sizing-sm"></td>
									<td><input type="number" id="item_3_elect_input" class="form-control" aria-label="Small"
											aria-describedby="inputGroup-sizing-sm"></td>
									<td><input type="number" id="item_3_gold_input" class="form-control" aria-label="Small"
											aria-describedby="inputGroup-sizing-sm"></td>
									<td><input type="number" id="item_3_plat_input" class="form-control" aria-label="Small"
											aria-describedby="inputGroup-sizing-sm"></td>
								</tr>
								<tr id="item_4_row">
									<td><input type="text" id="item_4_name_input" class="form-control" aria-label="Small"
											aria-describedby="inputGroup-sizing-sm"></td>
									<td><input type="text" id="item_4_count_input" class="form-control" aria-label="Small"
											aria-describedby="inputGroup-sizing-sm"></td>
									<td><input type="number" id="item_4_copper_input" class="form-control" aria-label="Small"
											aria-describedby="inputGroup-sizing-sm"></td>
									<td><input type="number" id="item_4_silver_input" class="form-control" aria-label="Small"
											aria-describedby="inputGroup-sizing-sm"></td>
									<td><input type="number" id="item_4_elect_input" class="form-control" aria-label="Small"
											aria-describedby="inputGroup-sizing-sm"></td>
									<td><input type="number" id="item_4_gold_input" class="form-control" aria-label="Small"
											aria-describedby="inputGroup-sizing-sm"></td>
									<td><input type="number" id="item_4_plat_input" class="form-control" aria-label="Small"
											aria-describedby="inputGroup-sizing-sm"></td>
								</tr>
								<tr id="item_5_row">
									<td><input type="text" id="item_5_name_input" class="form-control" aria-label="Small"
											aria-describedby="inputGroup-sizing-sm"></td>
									<td><input type="text" id="item_5_count_input" class="form-control" aria-label="Small"
											aria-describedby="inputGroup-sizing-sm"></td>
									<td><input type="number" id="item_5_copper_input" class="form-control" aria-label="Small"
											aria-describedby="inputGroup-sizing-sm"></td>
									<td><input type="number" id="item_5_silver_input" class="form-control" aria-label="Small"
											aria-describedby="inputGroup-sizing-sm"></td>
									<td><input type="number" id="item_5_elect_input" class="form-control" aria-label="Small"
											aria-describedby="inputGroup-sizing-sm"></td>
									<td><input type="number" id="item_5_gold_input" class="form-control" aria-label="Small"
											aria-describedby="inputGroup-sizing-sm"></td>
									<td><input type="number" id="item_5_plat_input" class="form-control" aria-label="Small"
											aria-describedby="inputGroup-sizing-sm"></td>
								</tr>
							</table>
						</div>
					</div>
					<div class="row">
						<div class="col">
							<button onclick="divideMoney()" class="btn btn-success">Divide the Money!</button>
							<button onclick="reset()" class="btn btn-danger">Reset</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<script>
		function reset() {
			var oldRows = [];
			oldRows = document.getElementsByClassName("toBeDeleted");

			var size = oldRows.length - 1;

			for (i = size; i >= 0; i--) {
				oldRows[i].parentNode.removeChild(oldRows[i]);
			}

			inputs = document.getElementsByTagName("input");
			for (i = 0; i < inputs.length; i++) {
				inputs[i].value = "";
			}
		}

		function findPoorestPlayer(arrayOfPlayers) {
			var poorestPlayer = 0;

			for (i = 0; i < arrayOfPlayers.length; i++) {
				if (arrayOfPlayers[i].total < arrayOfPlayers[poorestPlayer].total) {
					poorestPlayer = i;
				}
			}

			return poorestPlayer;
		}

		function populateItems() {
			let items = [];
			// let total = copper + silver * 10 + electrum * 50 + gold * 100 + platinum * 1000;
			for (let i = 1; i < 6; i++) {
				let itemCount = document.getElementById('item_' + i + '_count_input').value;
				let itemName = document.getElementById('item_' + i + '_name_input').value;
				if (itemName == "") {
					break;
				} else {
					let itemValue = (document.getElementById('item_' + i + '_copper_input').value || 0) +
						(document.getElementById('item_' + i + '_silver_input').value || 0) * 10 +
						(document.getElementById('item_' + i + '_elect_input').value || 0) * 50 +
						(document.getElementById('item_' + i + '_gold_input').value || 0) * 100 +
						(document.getElementById('item_' + i + '_plat_input').value || 0) * 1000;

					for (let counter = 0; counter < itemCount; counter++) {
						items.push(
							{
								'id': items.length + 1,
								'name': itemName,
								'value': itemValue
							}
						)
					}
				}
			}
			console.log(items);
			return items;
		}

		function divideMoney() {
			var oldRows = [];
			oldRows = document.getElementsByClassName("toBeDeleted");

			var size = oldRows.length - 1;

			for (i = size; i >= 0; i--) {
				oldRows[i].parentNode.removeChild(oldRows[i]);
			}

			var copper;
			var silver;
			var electrum;
			var gold;
			var platinum;

			var items = populateItems();
			// var items = [
			// 	{ 'id': 1, 'name': 'Corniolo', 'value': 1000 },
			// 	{ 'id': 2, 'name': 'Corniolo', 'value': 1000 },
			// 	{ 'id': 3, 'name': 'Corniolo', 'value': 1000 },
			// 	{ 'id': 4, 'name': 'Corniolo', 'value': 1000 },
			// 	{ 'id': 5, 'name': 'Corniolo', 'value': 1000 },
			// 	{ 'id': 6, 'name': 'Peridotite', 'value': 1500 },
			// 	{ 'id': 7, 'name': 'Peridotite', 'value': 1500 },
			// 	{ 'id': 8, 'name': 'Perla', 'value': 10000 }

			// ]

			var players;

			if (document.getElementById("copperInput").value != "") {
				copper = parseInt(document.getElementById("copperInput").value);
			}
			else {
				copper = 0;
			}
			if (document.getElementById("silverInput").value != "") {
				silver = parseInt(document.getElementById("silverInput").value);
			}
			else {
				silver = 0;
			}
			if (document.getElementById("electrumInput").value != "") {
				electrum = parseInt(document.getElementById("electrumInput").value);
			}
			else {
				electrum = 0;
			}
			if (document.getElementById("goldInput").value != "") {
				gold = parseInt(document.getElementById("goldInput").value);
			}
			else {
				gold = 0;
			}
			if (document.getElementById("platinumInput").value != "") {
				platinum = parseInt(document.getElementById("platinumInput").value);
			}
			else {
				platinum = 0;
			}


			if (document.getElementById("playersInput").value != "") {
				players = parseInt(document.getElementById("playersInput").value);
			}
			else {
				return;
			}

			var playersArray = [];


			for (i = 0; i < players; i++) {
				playersArray.push({
					copper: 0,
					silver: 0,
					electrum: 0,
					gold: 0,
					platinum: 0,
					items: [],
					total: 0
				})
			}

			let total = copper + silver * 10 + electrum * 50 + gold * 100 + platinum * 1000;
			for (let item of items) {
				total += item['value']
			}

			targetDivision = total / players;

			while (total > 0) {
				var poorest = findPoorestPlayer(playersArray)

				if (items.length > 0) {
					let bestItem = items.reduce((prev, current) => {
						return (prev.value > current.value) ? prev : current
					});
					playersArray[poorest].items.push(bestItem);
					playersArray[poorest].total += bestItem['value'];

					items = items.filter((item, index, arr) => { return item['id'] != bestItem['id']; });
					total -= bestItem['value'];
				}
				else if (platinum > 0) {
					platinum--;
					playersArray[poorest].platinum++;
					playersArray[poorest].total += 1000;
					total -= 1000;
				}
				else if (gold > 0) {
					gold--;
					playersArray[poorest].gold++;
					playersArray[poorest].total += 100;
					total -= 100;
				}
				else if (electrum > 0) {
					electrum--;
					playersArray[poorest].electrum++;
					playersArray[poorest].total += 50;
					total -= 50;
				}
				else if (silver > 0) {
					silver--;
					playersArray[poorest].silver++;
					playersArray[poorest].total += 10;
					total -= 10;
				}
				else if (copper > 0) {
					copper--;
					playersArray[poorest].copper++;
					playersArray[poorest].total += 1;
					total -= 1;
				}
			}

			for (i = 1; i < players + 1; i++) {
				var row = document.createElement('tr');
				row.className = "toBeDeleted";

				var cell = document.createElement('td');
				cell.appendChild(document.createTextNode("Player " + i));
				row.appendChild(cell);

				var cell = document.createElement('td');
				cell.appendChild(document.createTextNode(playersArray[i - 1].copper));
				row.appendChild(cell);

				var cell = document.createElement('td');
				cell.appendChild(document.createTextNode(playersArray[i - 1].silver));
				row.appendChild(cell);

				var cell = document.createElement('td');
				cell.appendChild(document.createTextNode(playersArray[i - 1].electrum));
				row.appendChild(cell);

				var cell = document.createElement('td');
				cell.appendChild(document.createTextNode(playersArray[i - 1].gold));
				row.appendChild(cell);

				var cell = document.createElement('td');
				cell.appendChild(document.createTextNode(playersArray[i - 1].platinum));
				row.appendChild(cell);

				var cell = document.createElement('td');
				cell.appendChild(document.createTextNode(playersArray[i - 1].items.map((item) => { return item.name }).join(", ")));
				row.appendChild(cell);

				var cell = document.createElement('td');
				cell.appendChild(document.createTextNode(playersArray[i - 1].total));
				row.appendChild(cell);

				document.getElementById("output").appendChild(row);
			}

		}

		function checkEmpty(value) {
			if (value == null || value == "" || value == NaN) {
				return 0;
			}
			else {
				return value;
			}
		}

	</script>

</body>

</html>